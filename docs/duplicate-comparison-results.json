{
  "config/constants": {
    "status": "different",
    "differences": [
      "Functions only in target: isLocalhostRuntime",
      "Significant line count difference: 393 vs 432 lines"
    ],
    "stats": {
      "source": {
        "lines": 393,
        "exports": 23,
        "functions": 4,
        "classes": 0
      },
      "target": {
        "lines": 432,
        "exports": 23,
        "functions": 5,
        "classes": 0
      }
    },
    "content1": "/**\n * CENTRALIZED CONFIGURATION\n * DO NOT HARDCODE THESE VALUES ANYWHERE ELSE\n * \n * All WebSocket URLs, model names, and other configuration values\n * must be imported from this file.\n */\n\nconst trimTrailingSlash = (value: string) => value.replace(/\\/+$/, '')\n\nconst normalizeWebsocketUrl = (\n  rawValue: string | undefined,\n  {\n    fallback,\n    enforceSecure = false,\n  }: {\n    fallback: string\n    enforceSecure?: boolean\n  }\n) => {\n  if (!rawValue) {\n    return trimTrailingSlash(fallback)\n  }\n\n  try {\n    const trimmed = rawValue.trim()\n    const hasScheme = /^[a-z]+:\\/\\//i.test(trimmed)\n    const baseProtocol = enforceSecure ? 'wss://' : 'ws://'\n    const candidate = hasScheme ? trimmed : `${baseProtocol}${trimmed}`\n    const url = new URL(candidate)\n\n    if (url.protocol === 'http:') url.protocol = 'ws:'\n    if (url.protocol === 'https:') url.protocol = 'wss:'\n    if (enforceSecure && url.protocol !== 'wss:') {\n      url.protocol = 'wss:'\n    }\n\n    const hostname = url.hostname.toLowerCase()\n    const isLocalHost =\n      hostname === 'localhost' ||\n      hostname === '127.0.0.1' ||\n      hostname === '[::1]' ||\n      hostname.endsWith('.local') ||\n      hostname.endsWith('.localdomain')\n\n    if (!isLocalHost && url.protocol === 'wss:') {\n      if (url.port && url.port !== '443') {\n        console.warn(\n          `[WEBSOCKET_CONFIG] Stripping unsupported secure port \"${url.port}\" from ${url.hostname}`\n        )\n        url.port = ''\n      }\n    }\n\n    return trimTrailingSlash(url.toString())\n  } catch (error) {\n    console.warn(\n      '[WEBSOCKET_CONFIG] Invalid WebSocket URL provided; falling back to default',\n      error\n    )\n    return trimTrailingSlash(fallback)\n  }\n}\n\n// WebSocket Configuration\n// Check if we're in production at runtime (client-side aware)\nconst isProductionRuntime = () => {\n  // Server-side: use NODE_ENV\n  if (typeof window === 'undefined') {\n    return process.env.NODE_ENV === 'production'\n  }\n  // Client-side: check hostname to detect production domains\n  const hostname = typeof window !== 'undefined' ? window.location.hostname : ''\n  const isLocalhost =\n    hostname === 'localhost' ||\n    hostname === '127.0.0.1' ||\n    hostname === '[::1]' ||\n    hostname.endsWith('.local') ||\n    hostname.endsWith('.localdomain') ||\n    hostname.includes('.local')\n  return !isLocalhost && !hostname.includes('vercel.app')\n}\n\nexport const WEBSOCKET_CONFIG = {\n  // Distinct envs for prod vs dev to avoid accidental overrides\n  PRODUCTION_URL: normalizeWebsocketUrl(process.env.NEXT_PUBLIC_LIVE_SERVER_URL, {\n    fallback: 'wss://fb-consulting-websocket.fly.dev',\n    enforceSecure: true,\n  }),\n  DEVELOPMENT_URL: normalizeWebsocketUrl(process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_URL, {\n    fallback: 'ws://localhost:3001',\n  }),\n  get URL() {\n    // Runtime check for production\n    if (isProductionRuntime()) {\n      return this.PRODUCTION_URL\n    }\n    // Prefer explicit dev URL when present\n    if (process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_URL) return this.DEVELOPMENT_URL\n    // Derive from current host in the browser for local networks\n    if (typeof window !== 'undefined') {\n      const host = window.location.hostname\n      const isSecure = typeof window !== 'undefined' && window.location.protocol === 'https:'\n      const protocol = isSecure ? 'wss' : 'ws'\n      // WebSocket server runs on 3001, NOT the same port as Next.js (3000)\n      const port = process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_PORT ?? '3001'\n      const portSuffix = port ? `:${port}` : ''\n      return `${protocol}://${host}${portSuffix}`\n    }\n    return this.DEVELOPMENT_URL\n  },\n  RECONNECT_DELAY: 3000,\n  MAX_RECONNECT_ATTEMPTS: 5,\n  HEARTBEAT_INTERVAL: 30000, // 30 seconds\n  MAX_BUFFERED_AMOUNT: 500_000, // 500KB - buffer threshold for client\n  HEARTBEAT_TIMEOUT_MS: 45000, // Allow 45 seconds to accommodate server heartbeat interval\n  FRAME_QUEUE_MAX_SIZE: 5,\n  FRAME_QUEUE_PROCESS_INTERVAL: 500, // ms\n  LOW_QUALITY_JPEG: 0.75,\n  HIGH_BUFFER_THRESHOLD: 300_000, // 300KB - start reducing quality\n} as const\n\n// Gemini Model Names\nexport const GEMINI_MODELS = {\n  // NEW: Google's latest models (auto-update to newest)\n  FLASH_LATEST: 'gemini-flash-latest',              // Auto-updates to latest Flash\n  FLASH_LITE_LATEST: 'gemini-flash-lite-latest',    // Auto-updates to latest Lite\n\n  // NEW: Specific versions (predictable behavior)\n  FLASH_2025_09: 'gemini-2.5-flash-preview-09-2025',\n  FLASH_LITE_2025_09: 'gemini-2.5-flash-lite-preview-09-2025',\n  AUDIO_2025_09: 'gemini-live-2.5-flash-preview-native-audio-09-2025', // Live API native audio model (v7 compatible)\n\n  // NEW: Gemini 3.0\n  GEMINI_3_PRO_PREVIEW: 'gemini-3-pro-preview',\n\n  // LEGACY: For backward compatibility (deprecated models)\n\n  FLASH_EXP: 'gemini-2.0-flash-exp',                // Old experimental\n\n  // DEFAULTS: What each use case should use\n  DEFAULT_CHAT: 'gemini-flash-latest',               // Auto-updates to best\n  DEFAULT_VOICE: 'gemini-live-2.5-flash-preview-native-audio-09-2025', // Live API native audio (updated model name)\n  DEFAULT_MULTIMODAL: 'gemini-flash-latest',         // Best for images/video\n  DEFAULT_WEBCAM: 'gemini-flash-latest',             // Webcam analysis\n  DEFAULT_SCREEN: 'gemini-flash-latest',             // Screen capture\n  DEFAULT_FAST: 'gemini-flash-lite-latest',          // When speed matters\n  DEFAULT_RELIABLE: 'gemini-2.5-flash-preview-09-2025', // When predictability matters\n} as const\n\n// Gemini API Endpoints\nexport const GEMINI_ENDPOINTS = {\n  LIVE_API: 'generativelanguage.googleapis.com/v1beta/models',\n  STANDARD_API: 'generativelanguage.googleapis.com/v1/models',\n  STREAMING_API: 'generativelanguage.googleapis.com/v1beta/models',\n  V1_ALPHA_API: 'generativelanguage.googleapis.com/v1alpha/models', // Required for Gemini 3 features like media_resolution\n} as const\n\n// Embedding Models\nexport const EMBEDDING_MODELS = {\n  DEFAULT: 'text-embedding-004',\n  TEXT_EMBEDDING_004: 'text-embedding-004',\n} as const\n\n// Gemini 3.0 Specific Configurations\nexport const THINKING_LEVELS = {\n  LOW: 'low',\n  HIGH: 'high', // Default for Gemini 3\n} as const\n\nexport const MEDIA_RESOLUTIONS = {\n  LOW: 'media_resolution_low',\n  MEDIUM: 'media_resolution_medium',\n  HIGH: 'media_resolution_high',\n} as const\n\n// Gemini Live API Configuration\nexport const LIVE_API_CONFIG = {\n  // Use sendRealtimeInput(), NOT session.send()\n  METHOD_NAME: 'sendRealtimeInput',\n  AUDIO_ENCODING: 'pcm_s16le',\n  SAMPLE_RATE: 24000,\n  CHANNELS: 1,\n} as const\n\n// Type safety\nexport type GeminiModel = typeof GEMINI_MODELS[keyof typeof GEMINI_MODELS]\nexport type GeminiEndpoint = typeof GEMINI_ENDPOINTS[keyof typeof GEMINI_ENDPOINTS]\n\n// API Rate Limits\nexport const RATE_LIMITS = {\n  WEBCAM_CAPTURE_INTERVAL: 2000, // 2 seconds (for analysis, not streaming)\n  SCREEN_CAPTURE_INTERVAL: 2000, // 2 seconds (for analysis, not streaming)\n  // Live API streaming intervals - much longer to avoid overwhelming the API\n  WEBCAM_STREAM_INTERVAL: 1000, // 1 second - faster for real-time feel\n  SCREEN_STREAM_INTERVAL: 1000, // 1 second - faster for real-time feel\n} as const\n\n// Context Configuration\nexport const CONTEXT_CONFIG = {\n  REDIS_TTL: 3600, // 1 hour for active sessions\n  ARCHIVE_ON_DISCONNECT: true,\n  AUTO_GENERATE_PDF: true,\n  MIN_MESSAGES_FOR_ARCHIVE: 3, // Don't archive test conversations\n  SUMMARIZE_THRESHOLD: 50, // Summarize every 50 messages\n} as const\n\n// Security Configuration\nexport const SECURITY_CONFIG = {\n  ENABLE_PII_DETECTION: process.env.NODE_ENV === 'production',\n  ENABLE_PII_REDACTION: process.env.NODE_ENV === 'production',\n  ENABLE_AUDIT_LOGGING: true,\n  DATA_RETENTION_DAYS: 90, // GDPR compliance\n  ENABLE_ENCRYPTION_AT_REST: true, // For Supabase\n} as const\n\n// Session Configuration\nexport const SESSION_CONFIG = {\n  TIMEOUT: 30 * 60 * 1000, // 30 minutes\n  WARNING_THRESHOLD: 25 * 60 * 1000, // 25 minutes\n  HEARTBEAT_INTERVAL: 60 * 1000, // 1 minute\n} as const\n\n// Audio Configuration\nexport const AUDIO_CONFIG = {\n  SAMPLE_RATE: 24000,\n  CHANNELS: 1,\n  BIT_DEPTH: 16,\n  CHUNK_SIZE: 4096,\n  NOISE_GATE_THRESHOLD: -50, // dB\n} as const\n\n// Security / CORS\nexport const ALLOWED_ORIGINS = (\n  process.env.NEXT_PUBLIC_ALLOWED_ORIGINS ||\n  [\n    'https://fbcai.com',\n    'https://farzadbayat.com',\n    'https://www.farzadbayat.com',\n    'http://localhost:3000',\n    'http://localhost:3001',\n    'http://127.0.0.1:3000',\n    'http://127.0.0.1:3001',\n  ].join(',')\n)\n  .split(',')\n  .map((s) => s.trim())\n  .filter(Boolean)\n\n// Third-party API endpoints\nexport const EXTERNAL_ENDPOINTS = {\n  RESEND_EMAIL: process.env.NEXT_PUBLIC_RESEND_API_ENDPOINT || 'https://api.resend.com/emails',\n  PERPLEXITY_CHAT_COMPLETIONS:\n    process.env.NEXT_PUBLIC_PERPLEXITY_API_ENDPOINT || 'https://api.perplexity.ai/chat/completions',\n} as const\n\n// Contact details & scheduling configuration\nconst schedulingUsername = process.env.NEXT_PUBLIC_SCHEDULING_USERNAME || 'farzad-bayat'\nconst schedulingEvent = process.env.NEXT_PUBLIC_SCHEDULING_EVENT || '30min'\nconst schedulingBaseUrl = trimTrailingSlash(\n  process.env.NEXT_PUBLIC_SCHEDULING_BASE_URL || 'https://cal.com',\n)\nconst schedulingEmbedBaseUrl = trimTrailingSlash(\n  process.env.NEXT_PUBLIC_SCHEDULING_EMBED_BASE_URL || 'https://app.cal.com',\n)\nconst schedulingEmbedScript =\n  process.env.NEXT_PUBLIC_SCHEDULING_EMBED_SCRIPT || 'https://app.cal.com/embed/embed.js'\n\nexport const CONTACT_CONFIG = {\n  SUPPORT_EMAIL: process.env.NEXT_PUBLIC_CONTACT_EMAIL || 'farzad@fbc.ai',\n  WEBSITE_URL: process.env.NEXT_PUBLIC_WEBSITE_URL || 'https://fbc.ai',\n  DEFAULT_FROM_EMAIL: process.env.RESEND_FROM_EMAIL || 'F.B/c <contact@farzadbayat.com>',\n  SCHEDULING: {\n    USERNAME: schedulingUsername,\n    EVENT: schedulingEvent,\n    BOOKING_URL: `${schedulingBaseUrl}/${schedulingUsername}/${schedulingEvent}`,\n    EMBED_URL: `${schedulingEmbedBaseUrl}/${schedulingUsername}/${schedulingEvent}?embed=true`,\n    EMBED_SCRIPT_SRC: schedulingEmbedScript,\n    BASE_URL: schedulingBaseUrl,\n    EMBED_BASE_URL: schedulingEmbedBaseUrl,\n  },\n} as const\n\n// Voice System Configuration\nexport const VOICE_CONFIG = {\n  BY_LANG: {\n    'en-US': 'Puck',\n    'en-GB': 'Puck',\n    'nb-NO': 'Puck',\n    'sv-SE': 'Puck',\n    'de-DE': 'Puck',\n    'es-ES': 'Puck',\n  } as const,\n  DEFAULT_VOICE: 'Puck',\n  VISUAL_TRIGGERS: (process.env.LIVE_SERVER_VISUAL_TRIGGERS || 'screen,showing,look at,see this,dashboard,workflow')\n    .split(',')\n    .map(s => s.trim().toLowerCase())\n    .filter(Boolean),\n  VISUAL_INJECT_THROTTLE_MS: Math.max(\n    0,\n    Number.parseInt(process.env.LIVE_SERVER_VISUAL_INJECT_THROTTLE_MS || '8000', 10) || 8000\n  ),\n  CONTEXT_INJECT_DEBOUNCE_MS: Math.max(\n    0,\n    Number.parseInt(process.env.LIVE_SERVER_CONTEXT_INJECT_DEBOUNCE_MS || '600', 10) || 600\n  ),\n  INJECT_ON_CONTEXT_UPDATE: process.env.LIVE_SERVER_INJECT_ON_CONTEXT_UPDATE === '0' ? false : true,\n} as const\n\n// Gemini Configuration\nexport const GEMINI_CONFIG = {\n  DEFAULT_TEMPERATURE: 0.7,\n  MAX_TOKENS: 8192,\n  SYSTEM_PROMPT: `You are F.B/c, Farzad Bayat's sharp, friendly consulting assistant.\n- Speak concisely (2 sentences max by default).\n- Ask one focused question when you need more context.\n- Keep a natural voice tone; avoid lists unless asked.\n- You have VISUAL CAPABILITIES: You can see webcam and screen share video frames in real-time.\n- When you receive video input, acknowledge what you see and provide relevant insights.\nPronunciation: \"Farzad Bayat\" ~ \"Fahr–zahd Bye–yaht\" (soft 'a' in Farzad).`,\n} as const\n\n// Feature Flags\nexport const FEATURE_FLAGS = {\n  REASONING_STREAMING:\n    (process.env.NEXT_PUBLIC_FEATURE_REASONING_STREAMING || '0').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_REASONING_STREAMING || '').toLowerCase() === 'true',\n  SHOW_VOICE_OVERLAY:\n    (process.env.NEXT_PUBLIC_FEATURE_VOICE_OVERLAY || '1').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_VOICE_OVERLAY || '').toLowerCase() === 'true',\n  SHOW_USAGE_CARD:\n    (process.env.NEXT_PUBLIC_FEATURE_SHOW_USAGE_CARD || '0').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_SHOW_USAGE_CARD || '').toLowerCase() === 'true',\n  // Controls whether the primary chat experience is the dedicated /live page\n} as const\n\n// Agent Stage Configuration - User-friendly stage descriptions\nexport const AGENT_STAGE_CONFIG = {\n  DISCOVERY: {\n    label: \"Discovery\",\n    description: \"Understanding your business needs and goals\",\n    order: 1\n  },\n  SCORING: {\n    label: \"Analysis\",\n    description: \"Evaluating solution fit for your situation\",\n    order: 2\n  },\n  WORKSHOP_PITCH: {\n    label: \"Workshop Solution\",\n    description: \"Designing training approach for your team\",\n    order: 3\n  },\n  CONSULTING_PITCH: {\n    label: \"Custom Solution\",\n    description: \"Architecting enterprise AI implementation\",\n    order: 3\n  },\n  CLOSING: {\n    label: \"Proposal\",\n    description: \"Finalizing next steps and addressing questions\",\n    order: 4\n  },\n  SUMMARY: {\n    label: \"Summary\",\n    description: \"Preparing your personalized strategy report\",\n    order: 5\n  }\n} as const\n\n// Agent UI Configuration (canonical)\nexport const AGENT_UI_CONFIG = {\n  websocketUrl: WEBSOCKET_CONFIG.URL,\n  features: {\n    voice: true,\n    video: true,\n    screenShare: true,\n    chat: true,\n    transcripts: true,\n  },\n  reconnectAttempts: WEBSOCKET_CONFIG.MAX_RECONNECT_ATTEMPTS,\n  reconnectDelay: WEBSOCKET_CONFIG.RECONNECT_DELAY,\n  isPreConnectBufferEnabled: true,\n  agentName: 'fbc-agent',\n  model: GEMINI_MODELS.DEFAULT_VOICE,\n} as const\n\n// Admin Configuration\nexport const ADMIN_CONFIG = {\n  ADMIN_ID: 'farzad',\n  ADMIN_EMAIL: 'farzad@bayatconsulting.com',\n} as const\n",
    "content2": "/**\n * CENTRALIZED CONFIGURATION\n * DO NOT HARDCODE THESE VALUES ANYWHERE ELSE\n * \n * All WebSocket URLs, model names, and other configuration values\n * must be imported from this file.\n */\n\nconst trimTrailingSlash = (value: string) => value.replace(/\\/+$/, '')\n\nconst normalizeWebsocketUrl = (\n  rawValue: string | undefined,\n  {\n    fallback,\n    enforceSecure = false,\n  }: {\n    fallback: string\n    enforceSecure?: boolean\n  }\n) => {\n  if (!rawValue) {\n    return trimTrailingSlash(fallback)\n  }\n\n  try {\n    const trimmed = rawValue.trim()\n    const hasScheme = /^[a-z]+:\\/\\//i.test(trimmed)\n    const baseProtocol = enforceSecure ? 'wss://' : 'ws://'\n    const candidate = hasScheme ? trimmed : `${baseProtocol}${trimmed}`\n    const url = new URL(candidate)\n\n    if (url.protocol === 'http:') url.protocol = 'ws:'\n    if (url.protocol === 'https:') url.protocol = 'wss:'\n    if (enforceSecure && url.protocol !== 'wss:') {\n      url.protocol = 'wss:'\n    }\n\n    const hostname = url.hostname.toLowerCase()\n    const isLocalHost =\n      hostname === 'localhost' ||\n      hostname === '127.0.0.1' ||\n      hostname === '[::1]' ||\n      hostname.endsWith('.local') ||\n      hostname.endsWith('.localdomain')\n\n    if (!isLocalHost && url.protocol === 'wss:') {\n      if (url.port && url.port !== '443') {\n        console.warn(\n          `[WEBSOCKET_CONFIG] Stripping unsupported secure port \"${url.port}\" from ${url.hostname}`\n        )\n        url.port = ''\n      }\n    }\n\n    return trimTrailingSlash(url.toString())\n  } catch (error) {\n    console.warn(\n      '[WEBSOCKET_CONFIG] Invalid WebSocket URL provided; falling back to default',\n      error\n    )\n    return trimTrailingSlash(fallback)\n  }\n}\n\n// WebSocket Configuration\n// Check if we're running locally (client-side aware)\nconst isLocalhostRuntime = () => {\n  // Server-side: check NODE_ENV\n  if (typeof window === 'undefined') {\n    return process.env.NODE_ENV !== 'production'\n  }\n  \n  // Client-side: check hostname to detect localhost\n  const hostname = typeof window !== 'undefined' ? window.location.hostname : ''\n  return (\n    hostname === 'localhost' ||\n    hostname === '127.0.0.1' ||\n    hostname === '[::1]' ||\n    hostname.endsWith('.local') ||\n    hostname.endsWith('.localdomain') ||\n    hostname.includes('.local')\n  )\n}\n\n// Check if we're in production at runtime (client-side aware)\nconst isProductionRuntime = () => {\n  // Always use localhost when running locally, even if NEXT_PUBLIC_LIVE_SERVER_URL is set\n  if (isLocalhostRuntime()) {\n    return false\n  }\n  \n  // If NEXT_PUBLIC_LIVE_SERVER_URL is explicitly set and we're not on localhost, use it\n  if (process.env.NEXT_PUBLIC_LIVE_SERVER_URL) {\n    return true\n  }\n  \n  // Server-side: use NODE_ENV\n  if (typeof window === 'undefined') {\n    return process.env.NODE_ENV === 'production'\n  }\n  \n  // Client-side: production if not localhost (includes vercel.app, custom domains, etc.)\n  return true // We already checked for localhost above\n}\n\nexport const WEBSOCKET_CONFIG = {\n  // Distinct envs for prod vs dev to avoid accidental overrides\n  PRODUCTION_URL: normalizeWebsocketUrl(process.env.NEXT_PUBLIC_LIVE_SERVER_URL, {\n    fallback: 'wss://fb-consulting-websocket.fly.dev',\n    enforceSecure: true,\n  }),\n  DEVELOPMENT_URL: normalizeWebsocketUrl(process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_URL, {\n    fallback: 'ws://localhost:3001',\n  }),\n  get URL() {\n    // Always use localhost when running locally, even if NEXT_PUBLIC_LIVE_SERVER_URL is set\n    if (isLocalhostRuntime()) {\n      // Prefer explicit dev URL when present\n      if (process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_URL) {\n        console.log('[WEBSOCKET_CONFIG] Using dev URL from NEXT_PUBLIC_LIVE_SERVER_DEV_URL:', this.DEVELOPMENT_URL)\n        return this.DEVELOPMENT_URL\n      }\n      \n      // Derive from current host in the browser for local networks\n      if (typeof window !== 'undefined') {\n        const host = window.location.hostname\n        const isSecure = typeof window !== 'undefined' && window.location.protocol === 'https:'\n        const protocol = isSecure ? 'wss' : 'ws'\n        // WebSocket server runs on 3001, NOT the same port as Next.js (3000)\n        const port = process.env.NEXT_PUBLIC_LIVE_SERVER_DEV_PORT ?? '3001'\n        const portSuffix = port ? `:${port}` : ''\n        const devUrl = `${protocol}://${host}${portSuffix}`\n        console.log('[WEBSOCKET_CONFIG] Using dev URL (local development):', devUrl)\n        return devUrl\n      }\n      \n      console.log('[WEBSOCKET_CONFIG] Using default dev URL (local development):', this.DEVELOPMENT_URL)\n      return this.DEVELOPMENT_URL\n    }\n    \n    // Production mode - use NEXT_PUBLIC_LIVE_SERVER_URL if set, otherwise fallback\n    if (process.env.NEXT_PUBLIC_LIVE_SERVER_URL) {\n      console.log('[WEBSOCKET_CONFIG] Using production URL from NEXT_PUBLIC_LIVE_SERVER_URL:', this.PRODUCTION_URL)\n      return this.PRODUCTION_URL\n    }\n    \n    // Production fallback\n    console.log('[WEBSOCKET_CONFIG] Using production URL (fallback):', this.PRODUCTION_URL)\n    return this.PRODUCTION_URL\n  },\n  RECONNECT_DELAY: 3000,\n  MAX_RECONNECT_ATTEMPTS: 5,\n  HEARTBEAT_INTERVAL: 30000, // 30 seconds\n  MAX_BUFFERED_AMOUNT: 500_000, // 500KB - buffer threshold for client\n  HEARTBEAT_TIMEOUT_MS: 45000, // Allow 45 seconds to accommodate server heartbeat interval\n  FRAME_QUEUE_MAX_SIZE: 5,\n  FRAME_QUEUE_PROCESS_INTERVAL: 500, // ms\n  LOW_QUALITY_JPEG: 0.75,\n  HIGH_BUFFER_THRESHOLD: 300_000, // 300KB - start reducing quality\n} as const\n\n// Gemini Model Names\nexport const GEMINI_MODELS = {\n  // NEW: Google's latest models (auto-update to newest)\n  FLASH_LATEST: 'gemini-2.5-flash',              // Auto-updates to latest Flash\n  FLASH_LITE_LATEST: 'gemini-2.5-flash-lite',    // Auto-updates to latest Lite\n\n  // NEW: Specific versions (predictable behavior)\n  FLASH_2025_09: 'gemini-2.5-flash',\n  FLASH_LITE_2025_09: 'gemini-2.5-flash-lite',\n  AUDIO_2025_09: 'gemini-2.5-flash-native-audio-preview-09-2025', // Live API native audio model\n\n  // NEW: Gemini 3.0\n  GEMINI_3_PRO_PREVIEW: 'gemini-3-pro-preview',\n\n  // LEGACY: For backward compatibility (deprecated models)\n\n  FLASH_EXP: 'gemini-2.0-flash-exp',                // Old experimental\n\n  // DEFAULTS: What each use case should use\n  DEFAULT_CHAT: 'gemini-3-pro-preview',               // Standard Chat\n  DEFAULT_VOICE: 'gemini-2.5-flash-native-audio-preview-09-2025', // Live Voice\n  DEFAULT_MULTIMODAL: 'gemini-3-pro-preview',         // Vision\n  DEFAULT_WEBCAM: 'gemini-3-pro-preview',             // Webcam analysis\n  DEFAULT_SCREEN: 'gemini-3-pro-preview',             // Screen capture\n  DEFAULT_FAST: 'gemini-2.5-flash-lite',          // Quick Edit\n  DEFAULT_RELIABLE: 'gemini-2.5-flash', // Research\n} as const\n\n// Gemini API Endpoints\nexport const GEMINI_ENDPOINTS = {\n  LIVE_API: 'generativelanguage.googleapis.com/v1beta/models',\n  STANDARD_API: 'generativelanguage.googleapis.com/v1/models',\n  STREAMING_API: 'generativelanguage.googleapis.com/v1beta/models',\n  V1_ALPHA_API: 'generativelanguage.googleapis.com/v1alpha/models', // Required for Gemini 3 features like media_resolution\n} as const\n\n// Embedding Models\nexport const EMBEDDING_MODELS = {\n  DEFAULT: 'text-embedding-004',\n  TEXT_EMBEDDING_004: 'text-embedding-004',\n} as const\n\n// Gemini 3.0 Specific Configurations\nexport const THINKING_LEVELS = {\n  LOW: 'low',\n  HIGH: 'high', // Default for Gemini 3\n} as const\n\nexport const MEDIA_RESOLUTIONS = {\n  LOW: 'media_resolution_low',\n  MEDIUM: 'media_resolution_medium',\n  HIGH: 'media_resolution_high',\n} as const\n\n// Gemini Live API Configuration\nexport const LIVE_API_CONFIG = {\n  // Use sendRealtimeInput(), NOT session.send()\n  METHOD_NAME: 'sendRealtimeInput',\n  AUDIO_ENCODING: 'pcm_s16le',\n  SAMPLE_RATE: 24000,\n  CHANNELS: 1,\n} as const\n\n// Type safety\nexport type GeminiModel = typeof GEMINI_MODELS[keyof typeof GEMINI_MODELS]\nexport type GeminiEndpoint = typeof GEMINI_ENDPOINTS[keyof typeof GEMINI_ENDPOINTS]\n\n// API Rate Limits\nexport const RATE_LIMITS = {\n  WEBCAM_CAPTURE_INTERVAL: 2000, // 2 seconds (for analysis, not streaming)\n  SCREEN_CAPTURE_INTERVAL: 2000, // 2 seconds (for analysis, not streaming)\n  // Live API streaming intervals - much longer to avoid overwhelming the API\n  WEBCAM_STREAM_INTERVAL: 1000, // 1 second - faster for real-time feel\n  SCREEN_STREAM_INTERVAL: 1000, // 1 second - faster for real-time feel\n} as const\n\n// Context Configuration\nexport const CONTEXT_CONFIG = {\n  REDIS_TTL: 3600, // 1 hour for active sessions\n  ARCHIVE_ON_DISCONNECT: true,\n  AUTO_GENERATE_PDF: true,\n  MIN_MESSAGES_FOR_ARCHIVE: 3, // Don't archive test conversations\n  SUMMARIZE_THRESHOLD: 50, // Summarize every 50 messages\n} as const\n\n// Security Configuration\nexport const SECURITY_CONFIG = {\n  ENABLE_PII_DETECTION: process.env.NODE_ENV === 'production',\n  ENABLE_PII_REDACTION: process.env.NODE_ENV === 'production',\n  ENABLE_AUDIT_LOGGING: true,\n  DATA_RETENTION_DAYS: 90, // GDPR compliance\n  ENABLE_ENCRYPTION_AT_REST: true, // For Supabase\n} as const\n\n// Session Configuration\nexport const SESSION_CONFIG = {\n  TIMEOUT: 30 * 60 * 1000, // 30 minutes\n  WARNING_THRESHOLD: 25 * 60 * 1000, // 25 minutes\n  HEARTBEAT_INTERVAL: 60 * 1000, // 1 minute\n} as const\n\n// Audio Configuration\nexport const AUDIO_CONFIG = {\n  SAMPLE_RATE: 24000,\n  CHANNELS: 1,\n  BIT_DEPTH: 16,\n  CHUNK_SIZE: 4096,\n  NOISE_GATE_THRESHOLD: -50, // dB\n} as const\n\n// Security / CORS\nexport const ALLOWED_ORIGINS = (\n  process.env.NEXT_PUBLIC_ALLOWED_ORIGINS ||\n  [\n    'https://fbcai.com',\n    'https://farzadbayat.com',\n    'https://www.farzadbayat.com',\n    'http://localhost:3000',\n    'http://localhost:3001',\n    'http://127.0.0.1:3000',\n    'http://127.0.0.1:3001',\n  ].join(',')\n)\n  .split(',')\n  .map((s) => s.trim())\n  .filter(Boolean)\n\n// Third-party API endpoints\nexport const EXTERNAL_ENDPOINTS = {\n  RESEND_EMAIL: process.env.NEXT_PUBLIC_RESEND_API_ENDPOINT || 'https://api.resend.com/emails',\n  PERPLEXITY_CHAT_COMPLETIONS:\n    process.env.NEXT_PUBLIC_PERPLEXITY_API_ENDPOINT || 'https://api.perplexity.ai/chat/completions',\n} as const\n\n// Contact details & scheduling configuration\nconst schedulingUsername = process.env.NEXT_PUBLIC_SCHEDULING_USERNAME || 'farzad-bayat'\nconst schedulingEvent = process.env.NEXT_PUBLIC_SCHEDULING_EVENT || '30min'\nconst schedulingBaseUrl = trimTrailingSlash(\n  process.env.NEXT_PUBLIC_SCHEDULING_BASE_URL || 'https://cal.com',\n)\nconst schedulingEmbedBaseUrl = trimTrailingSlash(\n  process.env.NEXT_PUBLIC_SCHEDULING_EMBED_BASE_URL || 'https://app.cal.com',\n)\nconst schedulingEmbedScript =\n  process.env.NEXT_PUBLIC_SCHEDULING_EMBED_SCRIPT || 'https://app.cal.com/embed/embed.js'\n\nexport const CONTACT_CONFIG = {\n  SUPPORT_EMAIL: process.env.NEXT_PUBLIC_CONTACT_EMAIL || 'farzad@fbc.ai',\n  WEBSITE_URL: process.env.NEXT_PUBLIC_WEBSITE_URL || 'https://fbc.ai',\n  DEFAULT_FROM_EMAIL: process.env.RESEND_FROM_EMAIL || 'F.B/c <contact@farzadbayat.com>',\n  SCHEDULING: {\n    USERNAME: schedulingUsername,\n    EVENT: schedulingEvent,\n    BOOKING_URL: `${schedulingBaseUrl}/${schedulingUsername}/${schedulingEvent}`,\n    EMBED_URL: `${schedulingEmbedBaseUrl}/${schedulingUsername}/${schedulingEvent}?embed=true`,\n    EMBED_SCRIPT_SRC: schedulingEmbedScript,\n    BASE_URL: schedulingBaseUrl,\n    EMBED_BASE_URL: schedulingEmbedBaseUrl,\n  },\n} as const\n\n// Voice System Configuration\nexport const VOICE_CONFIG = {\n  BY_LANG: {\n    'en-US': 'Puck',\n    'en-GB': 'Puck',\n    'nb-NO': 'Puck',\n    'sv-SE': 'Puck',\n    'de-DE': 'Puck',\n    'es-ES': 'Puck',\n  } as const,\n  DEFAULT_VOICE: 'Puck',\n  VISUAL_TRIGGERS: (process.env.LIVE_SERVER_VISUAL_TRIGGERS || 'screen,showing,look at,see this,dashboard,workflow')\n    .split(',')\n    .map(s => s.trim().toLowerCase())\n    .filter(Boolean),\n  VISUAL_INJECT_THROTTLE_MS: Math.max(\n    0,\n    Number.parseInt(process.env.LIVE_SERVER_VISUAL_INJECT_THROTTLE_MS || '8000', 10) || 8000\n  ),\n  CONTEXT_INJECT_DEBOUNCE_MS: Math.max(\n    0,\n    Number.parseInt(process.env.LIVE_SERVER_CONTEXT_INJECT_DEBOUNCE_MS || '600', 10) || 600\n  ),\n  INJECT_ON_CONTEXT_UPDATE: process.env.LIVE_SERVER_INJECT_ON_CONTEXT_UPDATE === '0' ? false : true,\n} as const\n\n// Gemini Configuration\nexport const GEMINI_CONFIG = {\n  DEFAULT_TEMPERATURE: 0.7,\n  MAX_TOKENS: 8192,\n  SYSTEM_PROMPT: `You are F.B/c, Farzad Bayat's sharp, friendly consulting assistant.\n- Speak concisely (2 sentences max by default).\n- Ask one focused question when you need more context.\n- Keep a natural voice tone; avoid lists unless asked.\n- You have VISUAL CAPABILITIES: You can see webcam and screen share video frames in real-time.\n- When you receive video input, acknowledge what you see and provide relevant insights.\nPronunciation: \"Farzad Bayat\" ~ \"Fahr–zahd Bye–yaht\" (soft 'a' in Farzad).`,\n} as const\n\n// Feature Flags\nexport const FEATURE_FLAGS = {\n  REASONING_STREAMING:\n    (process.env.NEXT_PUBLIC_FEATURE_REASONING_STREAMING || '0').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_REASONING_STREAMING || '').toLowerCase() === 'true',\n  SHOW_VOICE_OVERLAY:\n    (process.env.NEXT_PUBLIC_FEATURE_VOICE_OVERLAY || '1').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_VOICE_OVERLAY || '').toLowerCase() === 'true',\n  SHOW_USAGE_CARD:\n    (process.env.NEXT_PUBLIC_FEATURE_SHOW_USAGE_CARD || '0').toLowerCase() === '1' ||\n    (process.env.NEXT_PUBLIC_FEATURE_SHOW_USAGE_CARD || '').toLowerCase() === 'true',\n  // Controls whether the primary chat experience is the dedicated /live page\n} as const\n\n// Agent Stage Configuration - User-friendly stage descriptions\nexport const AGENT_STAGE_CONFIG = {\n  DISCOVERY: {\n    label: \"Discovery\",\n    description: \"Understanding your business needs and goals\",\n    order: 1\n  },\n  SCORING: {\n    label: \"Analysis\",\n    description: \"Evaluating solution fit for your situation\",\n    order: 2\n  },\n  WORKSHOP_PITCH: {\n    label: \"Workshop Solution\",\n    description: \"Designing training approach for your team\",\n    order: 3\n  },\n  CONSULTING_PITCH: {\n    label: \"Custom Solution\",\n    description: \"Architecting enterprise AI implementation\",\n    order: 3\n  },\n  CLOSING: {\n    label: \"Proposal\",\n    description: \"Finalizing next steps and addressing questions\",\n    order: 4\n  },\n  SUMMARY: {\n    label: \"Summary\",\n    description: \"Preparing your personalized strategy report\",\n    order: 5\n  }\n} as const\n\n// Agent UI Configuration (canonical)\nexport const AGENT_UI_CONFIG = {\n  websocketUrl: WEBSOCKET_CONFIG.URL,\n  features: {\n    voice: true,\n    video: true,\n    screenShare: true,\n    chat: true,\n    transcripts: true,\n  },\n  reconnectAttempts: WEBSOCKET_CONFIG.MAX_RECONNECT_ATTEMPTS,\n  reconnectDelay: WEBSOCKET_CONFIG.RECONNECT_DELAY,\n  isPreConnectBufferEnabled: true,\n  agentName: 'fbc-agent',\n  model: GEMINI_MODELS.DEFAULT_VOICE,\n} as const\n\n// Admin Configuration\nexport const ADMIN_CONFIG = {\n  ADMIN_ID: 'farzad',\n  ADMIN_EMAIL: 'farzad@bayatconsulting.com',\n} as const\n"
  },
  "config/env": {
    "status": "identical",
    "differences": [],
    "stats": {
      "source": {
        "lines": 50,
        "exports": 2,
        "functions": 3,
        "classes": 0
      },
      "target": {
        "lines": 50,
        "exports": 2,
        "functions": 3,
        "classes": 0
      }
    },
    "content1": "/**\n * Environment resolution helpers\n * Centralizes how we read and normalize environment variables so\n * production (Vercel) and local dev behave the same.\n */\n\nimport { GoogleGenAI } from '@google/genai'\n\n/**\n * Resolve the Google/Gemini API key from any supported env var.\n * \n * IMPORTANT: This function is pure - it does NOT mutate global process.env.\n * The key is returned directly and passed to SDK constructors, preventing\n * Google from detecting the key as \"leaked\" when it appears in both env vars\n * and instance config simultaneously.\n */\nexport function getResolvedGeminiApiKey(): string {\n  const key =\n    process.env.GEMINI_API_KEY ||\n    process.env.GOOGLE_GEMINI_API_KEY ||\n    process.env.GOOGLE_GENERATIVE_AI_API_KEY ||\n    process.env.GOOGLE_API_KEY ||\n    ''\n\n  if (!key) {\n    throw new Error('Missing Google Generative AI API key (set GEMINI_API_KEY or GOOGLE_GENERATIVE_AI_API_KEY)')\n  }\n\n  // Return key directly without mutating global process.env\n  // This prevents Google from detecting keys as \"leaked\" when they appear\n  // in both env vars and instance config\n  return key\n}\n\n/**\n * Create a GoogleGenAI instance using API key directly.\n * \n * NOTE: For Google Grounding/search, we use API key directly (matches v7's working approach).\n * Service account is only used for Live API (voice), not for REST API calls.\n * \n * IMPORTANT: The SDK checks credentials at initialization time, not just request time.\n * Always create instances INSIDE `withApiKeyOnly()` wrapper to ensure service account\n * is unset before the SDK reads credentials.\n */\nexport function createGoogleGenAI(): GoogleGenAI {\n  const apiKey = getResolvedGeminiApiKey()\n  return new GoogleGenAI({ apiKey })\n}\n\n",
    "content2": "/**\n * Environment resolution helpers\n * Centralizes how we read and normalize environment variables so\n * production (Vercel) and local dev behave the same.\n */\n\nimport { GoogleGenAI } from '@google/genai'\n\n/**\n * Resolve the Google/Gemini API key from any supported env var.\n * \n * IMPORTANT: This function is pure - it does NOT mutate global process.env.\n * The key is returned directly and passed to SDK constructors, preventing\n * Google from detecting the key as \"leaked\" when it appears in both env vars\n * and instance config simultaneously.\n */\nexport function getResolvedGeminiApiKey(): string {\n  const key =\n    process.env.GEMINI_API_KEY ||\n    process.env.GOOGLE_GEMINI_API_KEY ||\n    process.env.GOOGLE_GENERATIVE_AI_API_KEY ||\n    process.env.GOOGLE_API_KEY ||\n    ''\n\n  if (!key) {\n    throw new Error('Missing Google Generative AI API key (set GEMINI_API_KEY or GOOGLE_GENERATIVE_AI_API_KEY)')\n  }\n\n  // Return key directly without mutating global process.env\n  // This prevents Google from detecting keys as \"leaked\" when they appear\n  // in both env vars and instance config\n  return key\n}\n\n/**\n * Create a GoogleGenAI instance using API key directly.\n * \n * NOTE: For Google Grounding/search, we use API key directly (matches v7's working approach).\n * Service account is only used for Live API (voice), not for REST API calls.\n * \n * IMPORTANT: The SDK checks credentials at initialization time, not just request time.\n * Always create instances INSIDE `withApiKeyOnly()` wrapper to ensure service account\n * is unset before the SDK reads credentials.\n */\nexport function createGoogleGenAI(): GoogleGenAI {\n  const apiKey = getResolvedGeminiApiKey()\n  return new GoogleGenAI({ apiKey })\n}\n\n"
  }
}