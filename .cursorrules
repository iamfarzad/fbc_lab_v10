# Cursor AI Rules for fbc_lab_v10 Project

> [!CAUTION]
> **READ FIRST:** Previous AI sessions created 55 fix commits in 2 weeks.
> These rules prevent that. Follow them strictly.

---

## ðŸ”´ CRITICAL RULES (NON-NEGOTIABLE)

### 1. BUILD MUST PASS BEFORE ANY WORK
```bash
pnpm build
```
If this fails â†’ FIX IT FIRST. Do not proceed.

### 2. App.tsx IS FROZEN
- DO NOT add useState, useEffect, useCallback to App.tsx
- Create hooks in `src/hooks/` instead
- Only add imports to App.tsx

### 3. NO src/ imports in api/ or server/
```typescript
// WRONG - causes ESM errors
import { foo } from 'src/core/utils';

// RIGHT - ESM compatible
import { foo } from '../../../src/core/utils.js';
```

### 4. VERIFY BUILD AFTER EVERY CHANGE
```bash
pnpm build && pnpm type-check
```
Never commit if these fail.

---

## Context Preservation

### At Session Start:
```bash
pnpm build                    # Must pass
cat PROJECT_STATUS.md | head -50
git status
```

### At Session End:
```bash
pnpm build                    # Must pass
git add -A && git commit -m "type: description"
# Update PROJECT_STATUS.md
```

---

## File Rules

| Location | Rule |
|----------|------|
| `App.tsx` | FROZEN - no new logic |
| `api/**/*.ts` | Relative imports + `.js` extensions |
| `server/**/*.ts` | Relative imports + `.js` extensions |
| `src/hooks/**` | Put new stateful logic here |
| `src/lib/**` | Put pure utilities here |

---

## Commit Format
```
<type>: <description>

feat:     New feature
fix:      Bug fix (must explain root cause)
refactor: Code restructure
test:     Adding tests
docs:     Documentation
chore:    Build/tooling
```

---

## Never Do
- Skip build verification
- Add logic to App.tsx
- Use `src/` imports in api/ or server/
- Commit before build passes
- Fix symptoms instead of root causes

---

## Documentation Rules

### Agent Documentation Updates
**Rule:** When making changes to agent code or flow, ALWAYS update `docs/AGENTS_DOCUMENTATION.md`

**See:** `docs/AGENT_DOCUMENTATION_UPDATE_RULES.md` for complete guidelines

**Quick Checklist:**
- [ ] Agent code changed? â†’ Update relevant agent section
- [ ] Prompt changed? â†’ Update Agent Instructions & Prompts section
- [ ] Routing changed? â†’ Update Orchestration System section
- [ ] New endpoint? â†’ Update API Endpoints section
- [ ] Architecture changed? â†’ Update Architecture Overview section
- [ ] Update "Last Updated" date in header

**Never:** Update archived documents or reference-only docs
